- pipeline: "test"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "refs/*"
  ref_type: "WILDCARD"
  trigger_condition: "ALWAYS"
  actions:
      -   action: "PHP 7.2"
          type: "BUILD"
          working_directory: "/buddy/composer-plugin"
          docker_image_name: "library/php"
          docker_image_tag: "7.2"
          execute_commands:
              - "composer validate"
              - "composer install"
              - "composer tests"
          setup_commands:
              - "echo \"memory_limit=-1\" >> /usr/local/etc/php/conf.d/buddy.ini"
              - "apt-get update && apt-get install -y git zip"
              - "curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer"
          volume_mappings:
              - "/:/buddy/composer-plugin"
          trigger_condition: "ALWAYS"
          shell: "BASH"
      -   action: "PHP 7.3"
          type: "BUILD"
          working_directory: "/buddy/composer-plugin"
          docker_image_name: "library/php"
          docker_image_tag: "7.3"
          execute_commands:
              - "composer validate"
              - "composer install"
              - "composer tests"
          setup_commands:
              - "echo \"memory_limit=-1\" >> /usr/local/etc/php/conf.d/buddy.ini"
              - "apt-get update && apt-get install -y git zip"
              - "curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer"
          volume_mappings:
              - "/:/buddy/composer-plugin"
          trigger_condition: "ALWAYS"
          shell: "BASH"
      - action: "PHP 7.4"
        type: "BUILD"
        working_directory: "/buddy/composer-plugin"
        docker_image_name: "library/php"
        docker_image_tag: "7.4"
        execute_commands:
            - "composer validate"
            - "composer install"
            - "composer tests"
        setup_commands:
            - "echo \"memory_limit=-1\" >> /usr/local/etc/php/conf.d/buddy.ini"
            - "apt-get update && apt-get install -y git zip"
            - "curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer"
        volume_mappings:
            - "/:/buddy/composer-plugin"
        trigger_condition: "ALWAYS"
        shell: "BASH"
      - action: "PHP 8.0"
        type: "BUILD"
        working_directory: "/buddy/composer-plugin"
        docker_image_name: "library/php"
        docker_image_tag: "8.0"
        execute_commands:
            - "composer validate"
            - "composer update"
            - "composer tests"
        setup_commands:
            - "echo \"memory_limit=-1\" >> /usr/local/etc/php/conf.d/buddy.ini"
            - "apt-get update && apt-get install -y git zip"
            - "curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer"
        volume_mappings:
            - "/:/buddy/composer-plugin"
        trigger_condition: "ALWAYS"
        shell: "BASH"